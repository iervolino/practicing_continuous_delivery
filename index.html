<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">

    <title>Practicing Continuous Delivery</title>

    <meta name="description" content="">
    <meta name="author" content="James Ward">

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/print.css" type="text/css" media="print">

    <link rel="stylesheet" href="lib/zenburn.css">
    <style>
        .column2 {
            column-width: 300px;
            -webkit-column-width: 300px;
            -moz-column-width: 300px;
            column-count: 2;
            -webkit-column-count: 2;
            -moz-column-count: 2;
            column-gap: 50px;
            -webkit-column-gap: 50px;
            -moz-column-gap: 50px;
        }
    </style>
</head>

<body>

<div class="reveal">

<!-- Used to fade in a background when a specific slide state is reached -->
<div class="state-background"></div>

<!-- Any section element inside of this container is displayed as a slide -->
<div class="slides">
<section>
    <h1>Practicing Continuous Delivery</h1>
    <h3 class="inverted"><a href="http://twitter.com/_JamesWard">@_JamesWard</a></h3>
    <script>
        // Delicously hacky. Look away.
        if( navigator.userAgent.match( /(iPhone|iPad|iPod|Android)/i ) ) document.write( '<p style="color: rgba(0,0,0,0.3); text-shadow: none;">('+'Tap to navigate'+')</p>' );
    </script>
</section>
<section>
    <h2>Agenda</h2>
    <ol>
        <li><a href="#/2">Continuous Delivery</a></li>
        <li><a href="#/4">Intro: Play Framework</a>, <a href="#/5">Git</a>, <a href="#/6">Heroku</a></li>
        <li><a href="#/7">Practice: Micro Apps</a></li>
        <li><a href="#/8">Practice: Checkout, Build, Run</a></li>
        <li><a href="#/9">Practice: One Way Deployment</a></li>
        <li><a href="#/10">Practice: Zero Intervention Deployment</a></li>
        <li><a href="#/11">Practice: Isolated Schema Changes</a></li>
        <li><a href="#/12">Practice: Ephemeral App Tier</a></li>
        <li><a href="#/13">Practice: Logs as Streams</a></li>
        <li><a href="#/14">Practice: Monitor &amp; Notify</a></li>
    </ol>
</section>
<section>
    <section>
        <h2>Continuous Delivery</h2>
        <a href="http://en.wikipedia.org/wiki/Continuous_delivery"><img src="assets/Continuous_Delivery_process_diagram.png"></a><br/>
        <h3>Goals: Deliver Faster &amp; Reduce Risk</h3>
    </section>
    <section>
        <h3 class="inverted">Adjustable Process</h3>
        <br/>
        <ul>
            <li>Easy: Deploy direct to production</li>
            <li>Safe: Check into SCM, run CI / tests; then deploy</li>
        </ul>
    </section>
    <section>
        <h3 class="inverted">Continuous Delivery at Heroku</h3>
        <br/>
        <ul>
            <li>4000+ Heroku apps on Heroku</li>
            <li>500+ releases a day</li>
            <li>200+ deploys a day</li>
            <li>85 people</li>
            <li>21 teams</li>
        </ul>
    </section>
</section>
<section>
    <h2>Variety of Technology Options</h2>
    <br/>
    <h3 class="inverted">The examples here use:</h3>
    <ul>
        <li>Play Framework with Java</li>
        <li>Git</li>
        <li>Heroku</li>
        <li>PostgreSQL</li>
    </ul>
</section>
<section>
    <section>
        <h1>Play Framework</h1>
        <br/>
        <img src="assets/play_framework.png">
    </section>
    <section>
        <blockquote>Play is based on a lightweight, stateless, web-friendly architecture and features predictable and minimal resource consumption (CPU, memory, threads) for highly-scalable applications - thanks to its reactive model, based on Iteratee IO.</blockquote>
    </section>
    <section>
        <blockquote><span style="opacity: 0">Play is based on a</span> lightweight, stateless, web-friendly<span style="opacity: 0"> architecture and features predictable and minimal resource consumption (CPU, memory, threads)</span> for highly-scalable applications<span style="opacity: 0"> - thanks to its reactive model, based on Iteratee IO.</span></blockquote>
    </section>
    <section>
        <h2>My Top 10 Favorite Features</h2>
        <ul style="list-style-type: none;">
            <li>0) Simple</li>
            <li>1) URL Routing</li>
            <li>2) Class Reloading</li>
            <li>3) Share-Nothing</li>
            <li>4) Java &amp; Scala Support</li>
            <li>5) Great Testing Support</li>
            <li>6) JPA/EBean Support</li>
            <li>7) NIO Server (Netty)</li>
            <li>8) Asset Compiler</li>
            <li>9) Instant Deployment on Heroku</li>
        </ul>
    </section>
    <section>
        <h2>Create a new Play App</h2>
        <br/>
        <pre><code>$ play new foo</code></pre>
    </section>
</section>
<section>
    <h2>Git- Distributed SCM</h2>
    <br/>
    <h3 class="inverted">Create a Git Repo:</h3>
    <pre><code>$ git init
$ git add .
$ git commit -m init</code></pre>
</section>
<section>
    <section>
        <h1>Heroku</h1>
        <h3 class="inverted">Cloud Application Platform</h3>
        <img src="assets/ruby.png" style="height: 70px; border: 0px;">
        <img src="assets/python.png" style="height: 70px; border: 0px; background-color: #cccccc;">
        <img src="assets/nodejs.png" style="height: 70px; border: 0px;">
        <br/>
        <img src="assets/java.png" style="width: 50px; border: 0px; background-color: #eeeeee; padding: 10px;">
        <img src="assets/play.png" style="height: 50px; border: 0px; background-color: #eeeeee; padding: 10px;">
        <img src="assets/clojure.png" style="height: 50px; border: 0px; background-color: #eeeeee; padding: 10px;">
        <img src="assets/scala.png" style="height: 50px; border: 0px; background-color: #eeeeee; padding: 10px;">
        <br/>
        <br/>
        <h3>1,871,268+ Apps Running on Heroku</h3>
    </section>
    <section>
        <h2>Heroku Terminology</h2>
        <img src="assets/heroku_terms.png" style="width: 100%">
    </section>
    <section>
        <h2>Deploying on Heroku</h2>
        <br/>
        <h3 class="inverted">Provision an App</h3>
        <pre><code>$ heroku create</code></pre>
        <br/>
        <h3 class="inverted">Deploy</h3>
        <pre><code>$ git push heroku master</code></pre>
        <br/>
        <h3 class="inverted">Make a Change & Deploy</h3>
        <pre><code>$ # make change
$ git commit -am "change"
$ git push heroku master</code></pre>
    </section>
</section>
<section>
    <section>
        <h2>Practice: Micro Apps</h2>
        <br/>
        <h3 class="inverted">Barrier: Monolithic Apps</h3>
        <h3 class="inverted"><blockquote style="width: 100%">Does app startup take more than 1 minute?</blockquote></h3>
        <br/>
        <ul>
            <li>Decouple through APIs (HTTP, Pub/Sub, etc)</li>
            <li>Reduce the barriers to deploying new apps</li>
        </ul>
    </section>
    <section>
        <h3>Add a JSON Service</h3>
        <br/>
        <h4 class="inverted">app/controllers/Applicaiton.java</h4>
        <pre><code>        public static Result hello() {
            ObjectNode result = Json.newObject();
            result.put("message", "hello, world");
            return ok(result);
        }</code></pre>
        <br/>
        <h4 class="inverted">conf/routes</h4>
        <pre><code>GET     /hello                      controllers.Application.hello()</code></pre>
        <br/>
        <h3 class="inverted">Deploy</h3>
        <pre><code>$ git commit -am "Add JSON Service"
$ git push heroku master</code></pre>
    </section>
</section>
<section>
    <section>
        <h2>Practice: Checkout, Build, Run</h2>
        <br/>
        <h3 class="inverted">Barrier: Creating New Environments is Difficult</h3>
        <h3 class="inverted"><blockquote>Does getting a new developer setup take more than 15 minutes?</blockquote></h3>
        <br/>
        <ul>
            <li><span style="text-decoration: line-through">It works on my machine.</span></li>
            <li>Everything needed is defined &amp; resolvable via a build tool</li>
            <li>Environments only differ through configuration</li>
        </ul>
    </section>
    <section>
        <h3>Staging Environment</h3>
        <br/>
        <h4 class="inverted">Create a Staging App</h4>
        <pre><code>$ git remote rename heroku prod
$ heroku create -r staging</code></pre>
        <br/>
        <h4 class="inverted">Push a New Feature to Staging</h4>
        <pre><code>$ git checkout -b newfeature
$ # make a change
$ git commit -am "new feature"
$ git push staging newfeature:master
        </code></pre>
    </section>
</section>
<section>
    <section>
        <h2>Practice: One Way Deployment</h2>
        <br/>
        <h3 class="inverted">Barrier: Unknown Source to Deployment Correlation</h3>
        <h3 class="inverted"><blockquote>Can I SSH in and make a change?</blockquote></h3>
        <br/>
        <ul>
            <li>Production changes requires source changes</li>
            <li>Correlation between code and running systems</li>
        </ul>
    </section>
    <section>
        <h3>Heroku Releases</h3>
        <br/>
        <pre><code>$ # make a change
$ git commit -am "a change"
$ git push prod master</code></pre>
        <br/>
        <pre><code>$ heroku releases
$ git log
$ heroku rollback</code></pre>
    </section>
</section>
<section>
    <section>
        <h2>Practice: Zero Intervention Deployment</h2>
        <br/>
        <h3 class="inverted">Barrier: Complicated Deployment Procedures</h3>
        <h3 class="inverted"><blockquote>Are there any credentials stored in the source repo?</blockquote></h3>
        <ul>
            <li>Each environment owns their config</li>
            <li>External Resources own their config</li>
        </ul>
    </section>
    <section>
        <h3>Heroku Config</h3>
        <br/>
        <pre><code>$ heroku config:add FOO=bar
$ heroku config
$ # use System.getenv("FOO")
$ git commit -am "add FOO use"
$ git push heroku master</code></pre>
    </section>
    <section>
        <h3>External Resources Own Their Config</h3>
        <br/>
        <pre><code>$ heroku config
$ heroku pg:reset *** TODO ***
$ heroku config</code></pre>
    </section>
</section>
<section>
    <section>
        <h2>Practice: Isolated Schema Changes</h2>
        <br/>
        <h3 class="inverted">Barrier: Combined Schema and Codes Changes</h3>
        <h3 class="inverted"><blockquote>Do schema changes and code changes happen at the same time?</blockquote></h3>
        <br/>
        <ul>
            <li>Versioned, Roll-Backable, etc</li>
            <li>Long running schema changes don't impact runtime</li>
            <li>Minimum Two Phase Migrations: First DB then Code</li>
        </ul>
    </section>
    <section>
        <h3 class="inverted">Setup Database</h3>
        <h4 class="inverted">project/Build.scala</h4>
        <pre><code>"postgresql" % "postgresql" % "9.1-901-1.jdbc4"</code></pre>
        <br/>
        <h4 class="inverted">conf/application.conf</h4>
        <pre><code>db.default.driver=org.postgresql.Driver
db.default.url=${?DATABASE_URL}
ebean.default="models.*"
applyEvolutions.default=true</code></pre>
        <br/>
        <h4 class="inverted">Create local Postgres Database</h4>
        <pre><code>$ sudo -u postgres createuser -P f
$ createdb -U f -W -h localhost f
$ export DATABASE_URL=postgres://f:f@localhost/f</code></pre>
    </section>
    <section>
        <h3 class="inverted">Create and Apply Schema Changes</h3>
        <h4 class="inverted">conf/evolutions/default/1.sql</h4>
        <pre><code># --- !Ups
create table bar (
    id                        varchar(255) not null,
    name                      varchar(255),
    constraint pk_bar primary key (id));
create sequence bar_seq;

# --- !Downs
drop table if exists bar cascade;
drop sequence if exists bar_seq;</code></pre>
        <br/>
        <h4 class="inverted">Apply Schema Changes Locally and Test</h4>
<pre><code>$ psql -U f -W -h localhost f</code></pre>
        <br/>
        <h4 class="inverted">Apply Schema Changes on Heroku and Test</h4>
        <pre><code>$ git add conf/evolutions/default/1.sql
$ git commit -am "add schema v1"
$ git push prod master
$ heroku pg:sql *** TODO ***</code></pre>
    </section>
    <section>
        <h3 class="inverted">Use the New Schema</h3>
        <h4 class="inverted">app/models/Bar.java</h4>
        <pre><code>package models;

import play.db.ebean.Model;

import javax.persistence.Entity;
import javax.persistence.Id;

@Entity
public class Bar extends Model {

    @Id
    public String id;

    public String name;

}</code></pre>
        <br/>
        <h4 class="inverted">Test then Deploy</h4>
        <pre><code>$ git commit -am "add Bar entity"
$ git push prod master</code></pre>
    </section>
    <section>
        <h3 class="inverted">Add a Column</h3>
        <h4 class="inverted">Update the Schema (conf/evolutions/default/2.sql)</h4>
        <pre><code># --- !Ups
alter table bar add column rating integer;

# --- !Downs
alter table bar delete column rating;</code></pre>
        <br/>
        <h4 class="inverted">Test then Deploy</h4>
        <br/>
        <h4 class="inverted">Update the Code (app/models/Bar.java)</h4>
        <pre><code>public Integer rating;</code></pre>
        <br/>
        <h4 class="inverted">Test then Deploy</h4>
    </section>
</section>
<section>
    <section>
        <h2>Practice: Ephemeral App Tier</h2>
        <br/>
        <h3 class="inverted">Barrier: State in the App</h3>
        <h3 class="inverted"><blockquote style="width: 100%">Does a <a href="http://techblog.netflix.com/2011/07/netflix-simian-army.html">Chaos Monkey</a> cause chaos?</blockquote></h3>
        <br/>
        <ul>
            <li>Local disk and memory are not persistent stores</li>
            <li>Server affinity prevents Continuous Delivery</li>
            <li>All persistent state is external to the app tier</li>
        </ul>
    </section>
    <section>
        <h3 class="inverted">Scaling on Heroku</h3>
        <br/>
        <pre><code>$ heroku scale web=50
$ heroku ps</code></pre>
    </section>
    <section>
        <h3 class="inverted">Stateless Web Tier</h3>
        <br/>
        <ul>
            <li>Add Session to App</li>
            <li>Deploy &amp; Run</li>
            <li>Consistency Across Instances</li>
            <li>Restart Instances</li>
        </ul>
    </section>
    <section>
        <h3 class="inverted">Zero-Error Change-Over</h3>
        <img src="assets/cd_heroku.png" style="width: 100%">
    </section>
</section>
<section>
    <section>
        <h2>Practice: Logs as Streams</h2>
        <br/>
        <h3 class="inverted">Barrier: Decentralized Logging</h3>
        <h3 class="inverted"><blockquote style="width: 100%">Are logs written to local disk?</blockquote></h3>
        <br/>
        <ul>
            <li>Externalize &amp; Centralize Logging</li>
            <li>One place to search</li>
            <li>Log rotation and disk filling are barriers</li>
        </ul>
    </section>
    <section>
        <h2>Logging on Heroku</h2>
        <br/>
        <ul>
            <li>All STDOUT, Router Logs, Buildpack Logs goes to Logplex</li>
            <li>View the logs for an app: <pre><code>$ heroku logs</code></pre></li>
            <li>Tail the logs for an app: <pre><code>$ heroku logs -t</code></pre></li>
        </ul>
    </section>
</section>
<section>
    <section>
        <h2>Practice: Monitor &amp; Notify</h2>
        <br/>
        <h3 class="inverted">Barrier: Reactive Feedback Loop</h3>
        <h3 class="inverted"><blockquote style="width: 100%">Do your users know before you when something goes wrong?</blockquote></h3>
        <br/>
        <ul>
            <li>Service Checks</li>
            <li>Log Monitoring</li>
            <li>Performance Monitoring</li>
        </ul>
    </section>
    <section>
        <h2>Service Checks</h2>
        <br/>
        <ul>
            <li><a href="http://pingdom.com">Pingdom</a></li>
        </ul>
    </section>
    <section>
        <h2>Log Monitoring</h2>
        <br/>
        <h3 class="inverted">Papertrail</h3>
        <pre><code>$ heroku addons:add papertrail
$ heroku addons:open papertrail</code></pre>
    </section>
    <section>
        <h2>Performance Monitoring</h2>
        <br/>
        <h3 class="inverted">New Relic</h3>
        <pre><code>$ heroku addons:add newrelic
$ heroku addons:open newrelic</code></pre>
    </section>
</section>
<section>
    <h2>Further Learning</h2>
    <br/>
    <ul>
        <li><h2><a href="http://www.12factor.net/">The Twelve Factor App</a></h2></li>
        <li><h2><a href="http://java.heroku.com/">Get Started with Java on Heroku</a></h2></li>
        <li><h2><a href="http://techblog.netflix.com/">The Netflix Tech Blog</a></h2></li>
    </ul>
</section>
</div>

<!-- The navigational controls UI -->
<aside class="controls">
    <a class="left" href="#">&#x25C4;</a>
    <a class="right" href="#">&#x25BA;</a>
    <a class="up" href="#">&#x25B2;</a>
    <a class="down" href="#">&#x25BC;</a>
</aside>

<!-- Displays presentation progress, max value changes via JS to reflect # of slides -->
<div class="progress"><span></span></div>

</div>

<!-- Optional libraries for code syntax highlighting and classList support in IE9 -->
<script src="lib/highlight.js"></script>
<script src="lib/classList.js"></script>

<script src="js/reveal.min.js"></script>

<script>
    // Parse the query string into a key/value object
    var query = {};
    location.search.replace( /[A-Z0-9]+?=(\w*)/gi, function(a) {
        query[ a.split( '=' ).shift() ] = a.split( '=' ).pop();
    } );

    // Fires when a slide with data-state=customevent is activated
    Reveal.addEventListener( 'customevent', function() {
        alert( '"customevent" has fired' );
    } );

    // Fires each time a new slide is activated
    Reveal.addEventListener( 'slidechanged', function( event ) {
        // event.previousSlide, event.currentSlide, event.indexh, event.indexv
    } );

    Reveal.initialize({
        // Display controls in the bottom right corner
        controls: true,

        // Display a presentation progress bar
        progress: true,

        // If true; each slide will be pushed to the browser history
        history: true,

        // Loops the presentation, defaults to false
        loop: false,

        // Flags if mouse wheel navigation should be enabled
        mouseWheel: true,

        // Apply a 3D roll to links on hover
        rollingLinks: false,

        // UI style
        theme: query.theme || 'default', // default/neon

        // Transition style
        transition: query.transition || 'default' // default/cube/page/concave/linear(2d)
    });

    hljs.initHighlightingOnLoad();
</script>

</body>
</html>
